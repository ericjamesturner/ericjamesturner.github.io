if (self.CavalryLogger) { CavalryLogger.start_js(["K0HaQ"]); }

__d("MessengerLiveLocationETAQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"557024247754605"};b.getQueryID=function(){return"1414244725326295"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("MercuryMessageLiveLocationETAFetcher",["Promise","DateConsts","MessengerLiveLocationETAQueryWebGraphQLQuery","WebGraphQL","nullthrows","promiseDone"],(function(a,b,c,d,e,f){"use strict";var g=60,h=new Map();function i(a){if(!h.has(a))return!1;a=b("nullthrows")(h.get(a));a=Date.now()-a.timestamp.getTime();return a<=b("DateConsts").MS_PER_SEC*g}function j(a){return new(b("Promise"))(function(c,d){var e=b("nullthrows")(a.coordinate),f=b("nullthrows")(a.sender_destination);b("promiseDone")(b("WebGraphQL").exec(new(b("MessengerLiveLocationETAQueryWebGraphQLQuery"))({queryParams:{gps_points:[{latitude:e.latitude,longitude:e.longitude},{latitude:f.latitude,longitude:f.longitude}],transportation:"CAR",traffic:!0}})),function(a){a=((a=a)!=null?(a=a.routing_eta)!=null?(a=a.routing_eta_data)!=null?(a=a.nodes)!=null?(a=a[0])!=null?a.eta_traffic:a:a:a:a:a)||null;if(a===null){d();return}a=Math.ceil(a/b("DateConsts").SEC_PER_MIN);c(a)})})}var k={isLiveLocationEligibleForETA:function(a){return!!a.coordinate&&!!a.sender_destination&&!a.is_expired},fetchETAToDestination:function(a){if(!k.isLiveLocationEligibleForETA(a))throw new Error("Cannot fetch ETA for live location");return new(b("Promise"))(function(c,d){var e=a.live_location_id;if(i(e)){d=b("nullthrows")(h.get(e));c(d.etaInMinutes);return}h.set(e,{timestamp:new Date(),etaInMinutes:null});b("promiseDone")(j(a),function(a){h.set(e,{timestamp:new Date(),etaInMinutes:a}),c(a)})})}};e.exports=k}),null);
__d("LiveLocationStopReason",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({EXPIRED:1,CANCELED:2,ARRIVED:3})}),null);
__d("MercuryMessageLiveLocationShareAttachmentGenerator",["fbt","DateConsts","GeoCoordinates","GeoMarker","LiveLocationStopReason","MercuryIDs","MercuryViewer","MessengerParticipants.bs","StaticGeoMapBase.react","formatDate","keyMirror"],(function(a,b,c,d,e,f,g){"use strict";var h=b("keyMirror")(b("LiveLocationStopReason")),i=545,j=280,k=15;a={generateShareAttachment:function(a,b,c){var d=y(a);return babelHelpers["extends"]({},b,{target:a,title:l(a).toString(),description:q(a,c).toString(),media:babelHelpers["extends"]({},b.media,{image:d&&d.toString()||"",image_size:{width:i,height:j}}),uri:""})}};function l(a){if(a.is_expired)return n(a);else return m(a)}function m(a){if(a.location_title)return a.location_title;else return g._("Live Location")}function n(a){var b=a.sender_destination;return b&&a.stop_reason===h.ARRIVED?o(b,a.sender.id):g._("Location sharing ended")}function o(a,c){a=a.label;c=b("MercuryIDs").getParticipantIDFromUserID(c);if(b("MercuryViewer").isViewer(c))if(a)return g._("You arrived at {destination}",[g._param("destination",a)]);else return g._("You arrived at the destination");else{c=p(c);if(a!=null)if(c!=null)return g._("{user} arrived at {destination}",[g._param("user",c),g._param("destination",a)]);else return g._("Arrived at {destination}",[g._param("destination",a)]);else if(c!=null)return g._("{user} arrived at the destination",[g._param("user",c)]);else return g._("Arrived at the destination")}}function p(a){a=b("MessengerParticipants.bs").getNow(a);return a&&a.short_name}function q(a,b){if(a.is_expired)return u(a);else{var c=a.sender_destination;if(c)return x(c,b);else return w(a.expiration_time)}}function r(a,b){return a.getDate()==a.getDate()&&a.getMonth()===b.getMonth()&&a.getFullYear()===b.getFullYear()}function s(a){return new Date(a*b("DateConsts").MS_PER_SEC)}function t(a){var c=new Date();a=s(a);var d=c.getTime()-a.getTime();if(r(c,a))return"g:ia";else if(d<b("DateConsts").MS_PER_WEEK)return"D g:ia";else return"M j"}function u(a){a=a.expiration_time;a=b("formatDate")(a,t(a));return g._("Last update {date}",[g._param("date",a)])}function v(a){a=s(a).getTime()-Date.now();return Math.ceil(a/(b("DateConsts").MS_PER_SEC*b("DateConsts").SEC_PER_MIN))}function w(a){a=v(a);return g._({"*":"Sharing for {number} minutes.","_1":"Sharing for 1 minute."},[g._plural(a,"number")])}function x(a,b){if(b)if(a.label)return g._("{eta_in_minutes} minute drive to {destination}.",[g._param("eta_in_minutes",b),g._param("destination",a.label)]);else return g._("{eta_in_minutes} minute drive to the destination.",[g._param("eta_in_minutes",b)]);else if(a.label)return g._("Sharing until {destination}.",[g._param("destination",a.label)]);else return g._("Sharing until destination.")}function y(a){a=a.coordinate;if(!a)return null;a=new(b("GeoMarker"))(new(b("GeoCoordinates"))(a.latitude,a.longitude));return b("StaticGeoMapBase.react").getMapImageURI({size:{width:i,height:j},zoom:k,markers:[a],boundingBox:null,center:null,paths:null})}e.exports=a}),null);
__d("MercuryMessageLiveLocationShareAttachment.react",["cx","FBMapInfoButtonUtils.react","Link.react","MercuryFallbackShareAttachmentContent.react","MercuryMessageLiveLocationETAFetcher","MercuryMessageLiveLocationShareAttachmentGenerator","MercuryShareAttachmentReactShape","MercuryShareAttachmentRenderLocations","React","XPlacesMapController","nullthrows","promiseDone","prop-types"],(function(a,b,c,d,e,f,g){"use strict";var h=b("FBMapInfoButtonUtils.react").composeMapInfoButtonAndComponent,i=b("React");a=function(a){babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={etaInMinutes:null},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidMount=function(){this.$1(this.state.etaInMinutes)};d.componentDidUpdate=function(a,b){this.$1(b.etaInMinutes)};d.render=function(){var a=this.props.attachment;a=b("MercuryMessageLiveLocationShareAttachmentGenerator").generateShareAttachment(this.$2(a),a,this.state.etaInMinutes);var c=this.$3(a),d=this.$2(a);if(b("MercuryShareAttachmentRenderLocations").isPreview(this.props.location)||d.is_expired)return c;d=b("XPlacesMapController").getURIBuilder().setInt("message_live_location_id",d.live_location_id).getURI();a=i.jsx(b("Link.react"),{className:"_5rw4",href:a.uri,ajaxify:d,rel:"dialog",target:"_blank",children:c});return h(a,{mapUrl:this.props.attachment.uri,mapBounds:null,zoom:null},"messenger",{horizontal:"left",vertical:"top"})};d.$3=function(a){a=babelHelpers["extends"]({},this.props,{attachment:a});return i.jsx(b("MercuryFallbackShareAttachmentContent.react"),babelHelpers["extends"]({},a))};d.$2=function(a){return b("nullthrows")(a.target)};d.$1=function(a){var c=this,d=this.$2(this.props.attachment);if(!b("MercuryMessageLiveLocationETAFetcher").isLiveLocationEligibleForETA(d))return;b("promiseDone")(b("MercuryMessageLiveLocationETAFetcher").fetchETAToDestination(d),function(b){b&&a!=b&&c.setState({etaInMinutes:b})})};return c}(i.Component);a.propTypes={attachment:b("MercuryShareAttachmentReactShape"),location:b("prop-types").oneOf(b("MercuryShareAttachmentRenderLocations").getValues())};e.exports=a}),null);